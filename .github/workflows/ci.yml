name: Static Code Analysis

on:
  pull_request:
    branches:
      - master
      - develop
  push:
    branches:
      - master
      - develop

jobs:
  static-check:
    runs-on: self-hosted
    
    steps:

    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # 需要完整的git历史来比较变更
        ssh-key: ${{ secrets.SSH_PUB_KEY }}

    - name: Run static code analysis
      run: |
        sudo docker run --rm -v $(pwd):/app -v $(pwd):/sast -u $(id -u):$(id -g) -w /app registry-egc.enflame-tech.com/enflame/ci_sast:v1.0-os bash -c 'cd /app && python3 /sast/run.py --all_ci_check'
